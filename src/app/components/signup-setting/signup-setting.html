<div class="form-container signup-container">
  <h2>Inscription</h2>
  <form [formGroup]="form" (ngSubmit)="onSubmit()">

    <!-- Nom -->
    <div class="form-group">
      <label>Nom</label>
      <input type="text" formControlName="name">
    </div>
    <div *ngIf="submitted && form.get('name')?.errors" class="error">
      <small *ngIf="form.get('name')?.errors?.['required']">Le nom est requis.</small>
      <small *ngIf="form.get('name')?.errors?.['minlength']">Le nom doit avoir au moins 2 caractÃ¨res.</small>
    </div>

    <!-- PrÃ©nom -->
    <div class="form-group">
      <label>PrÃ©nom</label>
      <input type="text" formControlName="prenom">
    </div>
    <div *ngIf="submitted && form.get('prenom')?.errors" class="error">
      <small *ngIf="form.get('prenom')?.errors?.['required']">Le prÃ©nom est requis.</small>
      <small *ngIf="form.get('prenom')?.errors?.['minlength']">Le prÃ©nom doit avoir au moins 2 caractÃ¨res.</small>
    </div>

    <!-- Email -->
    <div class="form-group">
      <label>Email</label>
      <input type="email" formControlName="email">
    </div>
    <div *ngIf="submitted && form.get('email')?.errors" class="error">
      <small *ngIf="form.get('email')?.errors?.['required']">L'email est requis.</small>
      <small *ngIf="form.get('email')?.errors?.['email']">Format d'email invalide.</small>
    </div>

    <!-- Formulaire pour les nouveaux utilisateurs -->
    <div *ngIf="!customer">

      <!-- Mot de passe -->
      <div class="form-group">
        <label>Mot de passe</label>
        <div class="password-wrapper">
          <input [type]="showPassword ? 'text' : 'password'" formControlName="password">
          <span class="toggle-eye" (click)="showPassword = !showPassword">
            {{ showPassword ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ‘ï¸' }}
          </span>
        </div>
      </div>

      <div class="password-criteria">
        <small [class.valid]="passwordLength" [class.invalid]="!passwordLength">Minimum 8 caractÃ¨res</small>
        <small [class.valid]="passwordHasUpper" [class.invalid]="!passwordHasUpper">Contient une majuscule</small>
        <small [class.valid]="passwordHasLower" [class.invalid]="!passwordHasLower">Contient une minuscule</small>
        <small [class.valid]="passwordHasSpecial" [class.invalid]="!passwordHasSpecial">
          Contient un caractÃ¨re spÃ©cial (!@#$%^&.*)
        </small>
      </div>

      <div *ngIf="submitted && form.get('password')?.errors" class="error">
        <small *ngIf="form.get('password')?.errors?.['required']">Le mot de passe est requis.</small>
        <small *ngIf="form.get('password')?.errors?.['minlength']">Minimum 8 caractÃ¨res.</small>
        <small *ngIf="form.get('password')?.errors?.['weakPassword']">Mot de passe trop faible.</small>
      </div>

      <!-- Confirmer mot de passe -->
      <div class="form-group">
        <label>Confirmer MDP</label>
        <div class="password-wrapper">
          <input [type]="showConfirmPassword ? 'text' : 'password'" formControlName="confirmPassword">
          <span class="toggle-eye" (click)="showConfirmPassword = !showConfirmPassword">
            {{ showConfirmPassword ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ‘ï¸' }}
          </span>
        </div>
      </div>

      <div *ngIf="submitted && form.get('confirmPassword')?.errors" class="error">
        <small *ngIf="form.get('confirmPassword')?.errors?.['required']">Confirmation requise.</small>
      </div>

      <div *ngIf="submitted && form.errors?.['mismatch']" class="error">
        <small>Les mots de passe ne correspondent pas.</small>
      </div>

      <button type="submit">S'inscrire</button>
    </div>

    <!-- Actions pour les utilisateurs connectÃ©s -->
    <div *ngIf="customer" class="connected-actions">

      <a routerLink="/settings/changePassword" class="change-password">Changer le mot de passe</a>
      <a routerLink="/settings/walletRecharge" class="wallet-recharge">Ajouter des fonds</a>

      <button type="submit" class="update-settings">Mettre Ã  jour les paramÃ¨tres</button>
      <button type="button" class="delete-account" (click)="deleteAccount()">Supprimer le compte</button>

    </div>

  </form>
</div>

<!-- Message dynamique aprÃ¨s soumission -->
<div *ngIf="submitted && !customer" class="submission-message">
  <div *ngIf="successRegister === true" class="success-message">
    ğŸ‰ Inscription rÃ©ussie ! Bienvenue !
  </div>
  <div *ngIf="successRegister === false" class="error-message">
    âŒ Ã‰chec de l'inscription : {{ error }}
  </div>
</div>

<div *ngIf="submitted && !!customer" class="submission-message">
  <div *ngIf="successRegister === true" class="success-message">
    ğŸ‰ Modifications rÃ©ussies
  </div>
  <div *ngIf="successRegister === false" class="error-message">
    âŒ Ã‰chec des modifications : {{ error }}
  </div>
</div>
